---
import { ProjectInfiniteScroll } from "@/components/project-infinite-scroll";
import BaseLayout from "@/layouts/base.astro";
import { cn } from "@/lib/cn";
import { PROJECTS } from "@/lib/constants";

export function getStaticPaths() {
	return [
		{
			params: {
				title: undefined,
			},
			props: {
				project: undefined,
			},
		},
		...PROJECTS.map((project) => {
			return {
				params: {
					title: project.slug,
				},
				props: {
					project,
				},
			};
		}),
	];
}

const { title } = Astro.params;
const { project } = Astro.props;
---

<BaseLayout
	title={project && title ? `${project.name} • Victor Ragojos` : "Projects • Victor Ragojos"}
>
	<main class="flex h-full min-h-0 w-full flex-col px-2 pb-2">
		<div
			class={cn(
				"relative isolate grid min-h-0 w-full flex-1 grid-cols-12 gap-2 border p-2",
				"bg-[url('/background.svg')] bg-size-[90px] bg-center bg-repeat",
			)}
		>
			<div
				class={cn(
					"border-foreground/70 bg-striped col-span-4 flex min-h-0 w-full flex-col overflow-hidden border px-2 pb-2",

					"max-md:data-[is-project-selected=false]:col-span-full",
					"max-md:data-[is-project-selected=true]:hidden",
				)}
				data-is-project-selected={!!project}
			>
				<span class="sr-only">Window</span>

				<div class="inline-flex h-6 w-full items-center justify-between">
					<h2 class="font-mono text-xs leading-none font-medium">[{PROJECTS.length}]</h2>
				</div>

				<div class="bg-background h-full w-full">
					<ul class="inline-flex h-full w-full flex-col overflow-y-auto rounded-sm border p-1 pb-2">
						{
							PROJECTS.map((p) => {
								return (
									<li class="group inline-flex h-auto w-full">
										<a
											aria-current={p.slug === title && "page"}
											class={cn(
												"inline-flex w-full cursor-pointer items-center gap-2 border-b py-1",

												"aria-[current=page]:bg-foreground aria-[current=page]:text-background aria-[current=page]:outline-hidden",
												"focus-visible:bg-foreground focus-visible:text-background focus-visible:outline-hidden",
												"hover:bg-foreground hover:text-background hover:outline-hidden",
											)}
											href={`/projects/${p.slug}/`}
										>
											{p.slug === title ? (
												<svg
													class="size-4"
													color="currentColor"
													fill="currentColor"
													height="1em"
													style="overflow:visible"
													viewBox="0 0 16 16"
													width="1em"
													xmlns="http://www.w3.org/2000/svg"
												>
													<path d="M2 4.5v4.6l.924-1.6A3 3 0 0 1 5.522 6h6.393A1.5 1.5 0 0 0 10.5 5H7a.5.5 0 0 1-.354-.146L4.94 3.146A.5.5 0 0 0 4.586 3H3.5A1.5 1.5 0 0 0 2 4.5Zm5.069 9.495A.506.506 0 0 1 7 14H3.5A2.5 2.5 0 0 1 1 11.5v-7A2.5 2.5 0 0 1 3.5 2h1.086a1.5 1.5 0 0 1 1.06.44L7.207 4H10.5a2.5 2.5 0 0 1 2.458 2.041c1.647.3 2.586 2.18 1.704 3.709l-1.585 2.745a3 3 0 0 1-2.598 1.5h-3.41ZM5.522 7A2 2 0 0 0 3.79 8l-1.585 2.745a1.5 1.5 0 0 0 1.299 2.25h6.975a2 2 0 0 0 1.732-1l1.585-2.745a1.5 1.5 0 0 0-1.3-2.25H5.522Z" />
												</svg>
											) : (
												<svg
													class="size-4"
													color="currentColor"
													fill="currentColor"
													height="1em"
													style="overflow: visible;"
													viewBox="0 0 16 16"
													width="1em"
													xmlns="http://www.w3.org/2000/svg"
												>
													<path d="M2 4.5V6h3.586a.5.5 0 0 0 .353-.146L7.293 4.5 5.939 3.146A.5.5 0 0 0 5.586 3H3.5A1.5 1.5 0 0 0 2 4.5Zm-1 0A2.5 2.5 0 0 1 3.5 2h2.086a1.5 1.5 0 0 1 1.06.44L8.207 4H12.5A2.5 2.5 0 0 1 15 6.5v5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 11.5v-7ZM2 7v4.5A1.5 1.5 0 0 0 3.5 13h9a1.5 1.5 0 0 0 1.5-1.5v-5A1.5 1.5 0 0 0 12.5 5H8.207l-1.56 1.56A1.5 1.5 0 0 1 5.585 7H2Z" />
												</svg>
											)}

											<span class="sr-only">
												{p.slug === title ? "Close" : "Open"} {p.name} Window
											</span>

											<span class="font-sans text-sm font-medium select-none">{p.name}</span>
										</a>
									</li>
								);
							})
						}
					</ul>
				</div>
			</div>

			<div
				class={cn(
					"border-foreground/70 bg-striped relative isolate col-span-8 flex min-h-0 w-full flex-col border px-2 pb-2",

					"max-md:data-[is-project-selected=false]:hidden",
					"max-md:data-[is-project-selected=true]:col-span-full",
				)}
				data-is-project-selected={!!project && !!title}
			>
				{
					(!project || !title) && (
						<>
							<span class="sr-only">Window</span>

							<div class="inline-flex h-6 w-full items-center justify-between">
								<h2 class="font-mono text-xs leading-none font-medium">EMPTY</h2>
							</div>

							<div class="relative isolate flex h-full min-h-0 w-full flex-col">
								<div class="bg-background inline-flex h-full w-full items-center justify-center rounded-sm border p-1">
									<h2 class="font-mono text-xl">[SELECT A PROJECT]</h2>
								</div>
							</div>
						</>
					)
				}
				{
					project && title && (
						<>
							<span class="sr-only">Window</span>

							<div class="inline-flex h-6 w-full items-center justify-between">
								<h2 class="font-mono text-xs leading-none font-medium">{project.name}</h2>

								<a
									class={cn(
										"bg-background text-foreground/70 inline-flex h-4 w-4 shrink-0 cursor-pointer items-center justify-center rounded-full border transition-colors",

										"focus-visible:bg-foreground focus-visible:text-background focus-visible:outline-hidden",
										"hover:bg-foreground hover:text-background hover:outline-hidden",
									)}
									href="/projects/"
								>
									<span class="sr-only">Close</span>

									<svg
										class="h-3 w-3"
										color="currentColor"
										fill="currentColor"
										height="1em"
										stroke-width="0"
										style="overflow: visible;"
										viewBox="0 0 16 16"
										width="1em"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											clip-rule="evenodd"
											d="m8 8.707 3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.646 3.646.707.708L8 8.707z"
											fill-rule="evenodd"
										/>
									</svg>
								</a>
							</div>

							<div class="relative isolate flex h-full min-h-0 w-full flex-col">
								<div class="bg-background grid h-full w-full grid-cols-12 gap-2 rounded-sm border p-1">
									<div
										class={cn(
											"col-span-4",

											"max-lg:col-span-full",
										)}
									>
										<ul class="flex w-full flex-col gap-1">
											<li class="grid w-full grid-cols-2 gap-2">
												<h3 class="col-span-1 font-mono text-xs uppercase">[Type]</h3>

												<span class="col-span-1 font-mono text-xs">{project.type}</span>
											</li>

											{project.source && (
												<li class="grid w-full grid-cols-2 gap-2">
													<h3 class="col-span-1 font-mono text-xs uppercase">[Source]</h3>

													<span class="col-span-1 font-mono text-xs">
														<a
															class={cn(
																"break-all underline",

																"focus-visible:bg-foreground focus-visible:text-background focus-visible:no-underline focus-visible:outline-hidden",
																"hover:bg-foreground hover:text-background hover:no-underline hover:outline-hidden",
															)}
															href={project.source}
															rel="noopener noreferrer"
															target="_blank"
														>
															{project.source}
														</a>
													</span>
												</li>
											)}

											<li class="grid w-full grid-cols-2 gap-2">
												<h3 class="col-span-1 font-mono text-xs uppercase">[Link]</h3>

												<span class="col-span-1 font-mono text-xs">
													<a
														class={cn(
															"break-all underline",

															"focus-visible:bg-foreground focus-visible:text-background focus-visible:no-underline focus-visible:outline-hidden",
															"hover:bg-foreground hover:text-background hover:no-underline hover:outline-hidden",
														)}
														href={project.url}
														rel="noopener noreferrer"
														target="_blank"
													>
														{project.url}
													</a>
												</span>
											</li>

											<li class="grid w-full grid-cols-2 gap-2">
												<h3 class="col-span-1 font-mono text-xs uppercase">[Stack]</h3>

												<span class="col-span-1 font-mono text-xs">{project.stack.join(", ")}</span>
											</li>
										</ul>

										<p class="mt-2 font-sans text-xs font-medium">{project.description}</p>
									</div>

									<ProjectInfiniteScroll
										class={cn(
											"col-span-8 min-h-0",

											"max-lg:col-span-full",
										)}
										client:load
										project={project}
									/>
								</div>
							</div>
						</>
					)
				}
			</div>
		</div>
	</main>
</BaseLayout>
