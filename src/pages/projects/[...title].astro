---
import { ProjectInfiniteScroll } from "@/components/project-infinite-scroll";
import BaseLayout from "@/layouts/base.astro";
import { cn } from "@/lib/cn";
import { PROJECTS } from "@/lib/constants";

export function getStaticPaths() {
	return [
		{
			params: {
				title: undefined,
			},
			props: {
				project: undefined,
			},
		},
		...PROJECTS.map((project) => {
			return {
				params: {
					title: project.slug,
				},
				props: {
					project,
				},
			};
		}),
	];
}

const { title } = Astro.params;
const { project } = Astro.props;
---

<BaseLayout
	title={project && title
		? `Project • ${project.name} • Victor Ragojos`
		: "Projects • Victor Ragojos"}
>
	<main
		class={cn(
			"flex min-h-0 flex-1 flex-col border p-2",
			"bg-[url('/background.svg')] bg-size-[90px] bg-center bg-repeat",
		)}
	>
		<div class="relative isolate grid min-h-0 w-full flex-1 grid-cols-12 gap-2">
			<div
				class={cn(
					"border-foreground/70 bg-striped col-span-4 flex min-h-0 w-full flex-col overflow-hidden border px-2 pb-2",

					"max-md:data-[is-project-selected=false]:col-span-full",
					"max-md:data-[is-project-selected=true]:hidden",
				)}
				data-is-project-selected={!!project}
			>
				<span class="sr-only">Window</span>

				<div class="inline-flex h-6 w-full items-center justify-between">
					<h2 class="font-mono text-xs leading-none font-medium">[{PROJECTS.length}]</h2>
				</div>

				<div class="bg-background h-full w-full">
					<ul class="inline-flex h-full w-full flex-col overflow-y-auto rounded-sm border p-1 pb-2">
						{
							PROJECTS.map((p) => {
								return (
									<li class="group inline-flex h-auto w-full">
										<a
											aria-current={p.slug === title && "page"}
											class={cn(
												"inline-flex w-full cursor-pointer items-center gap-2 border-b py-1",

												"aria-[current=page]:bg-foreground aria-[current=page]:text-background aria-[current=page]:outline-hidden",
												"focus-visible:bg-foreground focus-visible:text-background focus-visible:outline-hidden",
												"hover:bg-foreground hover:text-background hover:outline-hidden",
											)}
											href={`/projects/${p.slug}/`}
										>
											{p.slug === title ? (
												<svg
													class="h-4 w-4"
													color="currentColor"
													fill="currentColor"
													height="1em"
													stroke-width="0"
													style="overflow:visible"
													viewBox="0 0 16 16"
													width="1em"
													xmlns="http://www.w3.org/2000/svg"
												>
													<path d="M1.5 14h11l.48-.37 2.63-7-.48-.63H14V3.5l-.5-.5H7.71l-.86-.85L6.5 2h-5l-.5.5v11l.5.5zM2 3h4.29l.86.85.35.15H13v2H8.5l-.35.15-.86.85H3.5l-.47.34-1 3.08L2 3zm10.13 10H2.19l1.67-5H7.5l.35-.15.86-.85h5.79l-2.37 6z" />
												</svg>
											) : (
												<svg
													class="h-4 w-4"
													color="currentColor"
													fill="currentColor"
													height="1em"
													stroke-width="0"
													style="overflow: visible;"
													viewBox="0 0 16 16"
													width="1em"
													xmlns="http://www.w3.org/2000/svg"
												>
													<path d="M14.5 3H7.71l-.85-.85L6.51 2h-5l-.5.5v11l.5.5h13l.5-.5v-10L14.5 3zm-.51 8.49V13h-12V7h4.49l.35-.15.86-.86H14v1.5l-.01 4zm0-6.49h-6.5l-.35.15-.86.86H2v-3h4.29l.85.85.36.15H14l-.01.99z" />
												</svg>
											)}

											<span class="sr-only">
												{p.slug === title ? "Close" : "Open"} {p.name} Window
											</span>

											<span class="font-sans text-sm font-medium select-none">{p.name}</span>
										</a>
									</li>
								);
							})
						}
					</ul>
				</div>
			</div>

			<div
				class={cn(
					"border-foreground/70 bg-striped relative isolate col-span-8 flex min-h-0 w-full flex-col border px-2 pb-2",

					"max-md:data-[is-project-selected=false]:hidden",
					"max-md:data-[is-project-selected=true]:col-span-full",
				)}
				data-is-project-selected={!!project && !!title}
			>
				{
					(!project || !title) && (
						<>
							<span class="sr-only">Window</span>

							<div class="inline-flex h-6 w-full items-center justify-between">
								<h2 class="font-mono text-xs leading-none font-medium">EMPTY</h2>
							</div>

							<div class="relative isolate flex h-full min-h-0 w-full flex-col">
								<div class="bg-background inline-flex h-full w-full items-center justify-center rounded-sm border p-1">
									<h2 class="font-mono text-xl">[SELECT A PROJECT]</h2>
								</div>
							</div>
						</>
					)
				}
				{
					project && title && (
						<>
							<span class="sr-only">Window</span>

							<div class="inline-flex h-6 w-full items-center justify-between">
								<h2 class="font-mono text-xs leading-none font-medium">{project.name}</h2>

								<a
									class={cn(
										"bg-background text-foreground/70 inline-flex h-4 w-4 shrink-0 cursor-pointer items-center justify-center rounded-full border transition-colors",

										"focus-visible:bg-foreground focus-visible:text-background focus-visible:outline-hidden",
										"hover:bg-foreground hover:text-background hover:outline-hidden",
									)}
									href="/projects/"
								>
									<span class="sr-only">Close</span>

									<svg
										class="h-3 w-3"
										color="currentColor"
										fill="currentColor"
										height="1em"
										stroke-width="0"
										style="overflow: visible;"
										viewBox="0 0 16 16"
										width="1em"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											clip-rule="evenodd"
											d="m8 8.707 3.646 3.647.708-.707L8.707 8l3.647-3.646-.707-.708L8 7.293 4.354 3.646l-.707.708L7.293 8l-3.646 3.646.707.708L8 8.707z"
											fill-rule="evenodd"
										/>
									</svg>
								</a>
							</div>

							<div class="relative isolate flex h-full min-h-0 w-full flex-col">
								<div class="bg-background grid h-full w-full grid-cols-12 gap-2 rounded-sm border p-1">
									<div
										class={cn(
											"col-span-4",

											"max-lg:col-span-full",
										)}
									>
										<ul class="flex w-full flex-col gap-1">
											<li class="grid w-full grid-cols-2 gap-2">
												<h3 class="col-span-1 font-mono text-xs uppercase">[Type]</h3>

												<span class="col-span-1 font-mono text-xs">{project.type}</span>
											</li>

											{project.source && (
												<li class="grid w-full grid-cols-2 gap-2">
													<h3 class="col-span-1 font-mono text-xs uppercase">[Source]</h3>

													<span class="col-span-1 font-mono text-xs">
														<a
															class={cn(
																"break-all underline",

																"focus-visible:bg-foreground focus-visible:text-background focus-visible:no-underline focus-visible:outline-hidden",
																"hover:bg-foreground hover:text-background hover:no-underline hover:outline-hidden",
															)}
															href={project.source}
															rel="noopener noreferrer"
															target="_blank"
														>
															{project.source}
														</a>
													</span>
												</li>
											)}

											<li class="grid w-full grid-cols-2 gap-2">
												<h3 class="col-span-1 font-mono text-xs uppercase">[Link]</h3>

												<span class="col-span-1 font-mono text-xs">
													<a
														class={cn(
															"break-all underline",

															"focus-visible:bg-foreground focus-visible:text-background focus-visible:no-underline focus-visible:outline-hidden",
															"hover:bg-foreground hover:text-background hover:no-underline hover:outline-hidden",
														)}
														href={project.url}
														rel="noopener noreferrer"
														target="_blank"
													>
														{project.url}
													</a>
												</span>
											</li>

											<li class="grid w-full grid-cols-2 gap-2">
												<h3 class="col-span-1 font-mono text-xs uppercase">[Stack]</h3>

												<span class="col-span-1 font-mono text-xs">{project.stack.join(", ")}</span>
											</li>
										</ul>

										<p class="mt-2 font-sans text-sm">{project.description}</p>
									</div>

									<ProjectInfiniteScroll
										class={cn(
											"col-span-8 min-h-0",

											"max-lg:col-span-full",
										)}
										client:load
										project={project}
									/>
								</div>
							</div>
						</>
					)
				}
			</div>
		</div>
	</main>
</BaseLayout>
